LOAD "testlib.lgo

TO TIMERTEST.RUNNOTFOUNDTEST :instructions
  (RUNEXPECTERRORTEST :instructions 1401 "|Timer not found|)
END

TO TIMERTEST.LARGECALLBACK
   ; make sure that the timer facility doesn't crash when
   ; given a very long callback as input.
   LOCALMAKE "longcallback (LIST "Print QUOTED REPEATWORD "A 10000)

   SETTIMER   31 500 :longcallback
   WAIT 60
   CLEARTIMER 31
END

TO TIMERTEST.SMOKETEST
   SETSCREENCOLOR 1

   SETTIMER 31 100 [SETSCREENCOLOR (SCREENCOLOR + 1)]
   WAIT 60
   CLEARTIMER 31

   SETSCREENCOLOR 7
END

TO TIMERTEST.BADINPUT

   ;
   ; bad input for SETTIMER
   ;
   RUNDOESNTLIKEINPUTTEST [SETTIMER  0        100       [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER 32        100       [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER 1.5       100       [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER "badvalue 100       [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER [1]       100       [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER []        100       [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER {1}       100       [FD 1]]

   RUNDOESNTLIKEINPUTTEST [SETTIMER 1         -100      [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER 1         100.5     [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER 1         [100]     [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER 1         []        [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER 1         "badvalue [FD 1]]
   RUNDOESNTLIKEINPUTTEST [SETTIMER 1         {100}     [FD 1]]

   RUNNOTENOUGHINPUTSTEST [(SETTIMER 1 100)]
   RUNTOOMANYINPUTSTEST   [(SETTIMER 1 100 [FD 1] "toomany)]

   ;
   ; bad input for CLEARTIMER
   ; 
   RUNDOESNTLIKEINPUTTEST    [CLEARTIMER 32] ; illegal value
   TIMERTEST.RUNNOTFOUNDTEST [CLEARTIMER 31] ; non-existent

   RUNNOTENOUGHINPUTSTEST [(CLEARTIMER)]
   RUNTOOMANYINPUTSTEST   [(CLEARTIMER 1 "toomany)]

END

TO TIMERTEST

   TIMERTEST.SMOKETEST
   TIMERTEST.BADINPUT
   TIMERTEST.LARGECALLBACK

END
